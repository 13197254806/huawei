# 华为软挑

## 写

磁盘分页，让同类对象尽量聚集在同一页上。每一页上，统计各个类别的对象块数量，维护最高频的对象类型。每次写入对象优先找具有相同类型的页；如果找不到这样的页，则尝试去找空页；如果连空页也找不到，就去找一个剩余空间最大的页。

## 删

维护相关数据结构就好

## 读

用一个循环队列维护目前有效（即没过期，没被删，没完成）的请求。维护每个请求所需的对象块情况，根据有效请求中还未读到的对象块，为磁盘对应位置添加权重，进而获得每个页的权重。每次都去读一个权重最高的页，再将多个磁头的结果拼凑在一起，返回这一轮读到的对象。

设置一个阈值，当前块的权重大于这个阈值时才有可能读这个块。磁头在移动时，遇到一个不需要读的块，会自行规划在这个块上是使用pass还是保持read。

## TODO

目前还没有利用一开始给的统计信息，至少可以优化的地方包括：

1. 根据全局统计信息优化写入时的页号。目前需要新开页的时候，是从前往后遍历空页，这样虽然能让同一页上同类对象尽量聚集，但相邻两页却不能保证同类对象聚集。

2. 预先找出低频率对象，这些对象可以单独安排一块区域用来读写，减少碎片化同时提升读取效率。

3. 目前是一个对象随机分配3个磁盘写入。考虑设计更优的写策略，尽量减少磁头读取的对象块的重叠，提高并行度。

4. 目前必须是一个页读完，才能改去读其它页。应当有一个策略，即使当前页没读完，若当前页的剩余价值不高，这时可以放弃转而去读其它页。

5. 可调参数的优化

   