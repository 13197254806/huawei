# 华为软挑

## 写

磁盘分页，让同类对象尽量聚集在同一页上。每一页上，统计各个类别的对象块数量，维护最高频的对象类型。每次写入对象优先找具有相同类型的页。

## 删

维护相关数据结构就好

## 读

用一个双向链表维护目前有效（即没过期，没被删，没完成）的请求，链表中请求id按时间排序。维护每个请求所需的对象块情况，根据有效请求中还未读到的对象块，为磁盘对应位置添加权重，进而获得每个页的权重。每次都去读一个权重收益率最高的页，再将多个磁头的结果拼凑在一起，返回这一轮读到的对象。

磁头在移动时，会自行规划在这个块上是pass还是read（数学+贪心）。

## TODO

至少可以优化的地方包括：

1. 根据全局统计信息优化写入时的页号。目前需要新开页的时候，是从前往后遍历空页，这样虽然能让同一页上同类对象尽量聚集，但相邻两页却不能保证同类对象聚集

2. 根据对象大小安排写入位置，尽量减少删除时的磁盘碎片，或者碎片能尽量被无缝填充

3. 目前是一个对象随机分配3个磁盘写入。考虑设计更优的写策略，尽量减少磁头读取的对象块的重叠，提高并行度

4. 磁头的移动策略，细节还有问题，比如目前切换到另一页要么是jump，要么是一路pass过去，这样可能浪费令牌

5. 运行慢，还需要优化常数或者时间复杂度

6. 可调参数的优化

   